<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Resultados</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5">
    <div class="card p-4 shadow">
        <h3 class="mb-4">Resultados</h3>

        <h5 id="total"></h5>

        <table class="table">
            <thead>
                <tr>
                    <th>Candidato</th>
                    <th>Votos</th>
                    <th>%</th>
                </tr>
            </thead>
            <tbody id="tabla"></tbody>
        </table>
    </div>
</div>

<script>

const params = new URLSearchParams(window.location.search);
const election_id = params.get("election_id");

fetch(`http://localhost:5000/results/${election_id}`, {
    method: "GET",
    credentials: "include"
})
.then(async res => {
    const data = await res.json();

    if (!res.ok) {
        throw new Error(data.error || "Error");
    }

    return data;
})
.then(data => {

    document.getElementById("total").innerText =
        "Total votos: " + data.total_votes;

    const tabla = document.getElementById("tabla");

    data.results.forEach(r => {
        const fila = `
            <tr>
                <td>${r.name}</td>
                <td>${r.votes}</td>
                <td>${r.percentage}%</td>
            </tr>
        `;
        tabla.innerHTML += fila;
    });

})
.catch(err => {
    console.error("ERROR:", err.message);
    alert(err.message);
});

</script>

</body>
</html>