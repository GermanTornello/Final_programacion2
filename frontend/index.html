<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sistema de VotaciÃ³n - Elecciones</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<div class="container py-5">

    <div class="row justify-content-center">
        <div class="col-lg-8">

            <div class="card shadow-lg border-0 rounded-4">
                <div class="card-body p-4">

                    <h2 class="text-center mb-4 fw-bold">Sistema de VotaciÃ³n</h2>

                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0">Listado de Elecciones</h5>

                        <select id="filter" class="form-select w-auto">
                            <option value="all">Todas</option>
                            <option value="active">Activas</option>
                            <option value="upcoming">PrÃ³ximas</option>
                            <option value="closed">Cerradas</option>
                        </select>
                    </div>

                    <ul id="list" class="list-group list-group-flush"></ul>

                </div>
            </div>

        </div>
    </div>

</div>

<script>

const list = document.getElementById("list");
const filter = document.getElementById("filter");
let elections = [];

function render() {
    list.innerHTML = "";
    const value = filter.value;

    const filtered = value === "all"
        ? elections
        : elections.filter(e => e.status === value);

    if (filtered.length === 0) {
        const li = document.createElement("li");
        li.className = "list-group-item text-center text-muted py-3";
        li.textContent = "No hay elecciones para mostrar";
        list.appendChild(li);
        return;
    }

    const statusBadge = {
        active: "success",
        upcoming: "warning",
        closed: "secondary"
    };

    filtered.forEach(e => {
        const li = document.createElement("li");
        li.className = "list-group-item d-flex justify-content-between align-items-center py-3";

        li.innerHTML = `
            <div>
                <div class="fw-semibold">${e.name}</div>
                <small class="text-muted">
                    Inicio: ${new Date(e.start_date).toLocaleDateString()} |
                    Fin: ${new Date(e.end_date).toLocaleDateString()}
                </small>
            </div>
            <div>
                <span class="badge bg-${statusBadge[e.status]} px-3 py-2 me-2">
                    ${e.status}
                </span>

                ${e.status === "active" ? 
                    `<button class="btn btn-primary btn-sm me-2" onclick="goVote(${e.id})">
                        Votar
                    </button>` 
                    : ""
                }

                <button class="btn btn-outline-secondary btn-sm"
                    onclick="goResults(${e.id})">
                    Resultados
                </button>
            </div>
        `;

        list.appendChild(li);
    });
}

// ðŸ”¹ Traer elecciones del backend
fetch("http://localhost:5000/elections", {
    credentials: "include"
})
.then(res => {
    if (!res.ok) {
        throw new Error("No autorizado o error servidor");
    }
    return res.json();
})
.then(data => {
    elections = data;
    render();
})
.catch(err => {
    console.error("ERROR:", err);
    alert("Error conectando al backend");
});

// ðŸ”¹ Filtro
filter.addEventListener("change", render);

// ðŸ”¹ Ir a votar
function goVote(id) {
    window.location.href = `vote.html?election_id=${id}`;
}

// ðŸ”¹ Ir a resultados (CASO 3)
function goResults(id) {
    window.location.href = `results.html?election_id=${id}`;
}

</script>

</body>
</html>